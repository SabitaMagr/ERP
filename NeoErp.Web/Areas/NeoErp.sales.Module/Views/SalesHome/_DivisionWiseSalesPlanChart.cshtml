@using NeoErp.Core.Models;
@{
    var actionPageId = "DivisionWiseSalesPlan";
}

<div class="modal fade" id="Model_@actionPageId" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog custom-chart">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title">Division wise sales plan</h4>
            </div>
            <div class="modal-body bottom-gappingtwo form-horizontal">
                <div class="row">
                    <div class="branchwisesales-col clearfix">
                        <div class="btn-group options_DivisionWiseSalesPlan responsivegap col-sm-12 col-md-12" data-toggle="buttons" data-type="chart">
                            <button type="button" class="btn btn-sm default red-stripe active">
                                <i class="fa fa-bar-chart"></i>
                                <input id="typeColumn" name="seriesType_DivisionWiseSalesPlan"
                                       type="radio" value="column" checked="checked" autocomplete="off" />column
                            </button>
                            <button type="button" class="btn btn-sm default green-stripe">
                                <i class="fa fa-bar-chart"></i>
                                <input id="typeBar" name="seriesType_DivisionWiseSalesPlan"
                                       type="radio" value="bar" autocomplete="off" />bar
                            </button>
                            <button type="button" class="btn btn-sm default purple-stripe">
                                <i class="fa fa-line-chart"></i>
                                <input id="typeLine" name="seriesType_DivisionWiseSalesPlan"
                                       type="radio" value="line"  autocomplete="off" />Line
                            </button>
                        </div>
                        <div class="col-xs-12 col-md-6 col-sm-6 margin-buttom">
                            <h5> Choose Value Field</h5>
                            <div class="btn-group" data-toggle="buttons">
                                <button type="button" class="btn btn-sm default red-stripe">
                                    <i class="fa fa-cart-arrow-down"></i>
                                    <input id="QuantityColumn" name="fieldType_@actionPageId"
                                           type="radio" value="Quantity" autocomplete="off" /> Quantity
                                </button>
                                <button type="button" class="btn btn-sm default green-stripe active">
                                    <i class=""></i>
                                    <input id="typeBar" name="fieldType_@actionPageId"
                                           type="radio" value="Amount" checked="checked" autocomplete="off" /> Amount
                                </button>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="br"><div class="br"></div> </div>
                            <div class="clearfix" style="display:none;">
                                <div class="date-option">
                                    <label>
                                        <input type="radio" id="ADFormat" name="DateFormat_DivisionWiseSalesPlan" value="AD" /> AD
                                    </label>
                                    <label>
                                        <input type="radio" id="BSFormat" name="DateFormat_DivisionWiseSalesPlan" checked="checked" value="BS" /> BS
                                    </label>
                                </div>
                            </div>
                            <div>
                                <!-- show labels & inStack option-->
                                <div class="input-group">
                                    <div class="icheck-inline">
                                        <label>
                                            <input id="showLabel_DivisionWiseSalesPlan" type="checkbox" autocomplete="off" /> Show Labels
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="br"></div>


                <div class="filter_title">
                    <label class="filter-label">Advance Filter</label>
                </div>

                @Html.Partial("~/Views/Shared/Controls/DashboardChartFilter/_AdvancedFilter.cshtml", new AdvancedFilterSettingsModel()
                {
                    ShowCustomerFilter = true,
                    ShowProductFilter = false,
                    ShowPartyTypeFilter = false,
                    ShowCategoryFilter = false,
                    ShowLocationFilter = false,
                    ShowDocumentFilter = false,
                    ShowCompanyFilter = false,
                    ShowFiscalYearFilter = false,
                    ShowBranchFilter = true,
                    ShowEmployeeFilter = true,
                    ShowAgentFilter = false,
                    ShowDivisionFilter = true,
                    IsPopUp = false,
                    ActionPageId = actionPageId
                })
            </div>


            <div class="modal-footer">
                @*<button type="button" class="btn default" data-dismiss="modal">Close</button>*@
                <button type="button" class="btn btn-green applydp" data-dismiss="modal" id="apply_@actionPageId">Apply</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

<div class="portlet portlet-sortable  light bordered" id="DivisionWiseSalesPlan">
    <div class="portlet-title">
        <div class="caption">
            <i class="icon-bar-chart font-green-haze"></i>
            <span class="caption-subject bold uppercase font-green-haze custom-modal">Division wise Sales plan</span>
        </div>
        <div class="tools">
            <a href="javascript:;" class="collapse"></a>
            @*<a class="btnDatagrid" href="javascript:;" onclick="CreateGrid_DivisionWiseSalesPlan();" data-grid="Chart" title="Data grid">*@
            <a class="btnGrid btnGrid_DivisionWiseSalesPlan" data-type="Chart" data-title="Grid">
                <i class="fa fa-table"></i>
            </a>
            <a class="" id="btnBack" style="display:none">
                <i class="fa fa-angle-double-left"></i>
            </a>
            <div class="btn-group">
                <a class="btn dropdown-toggle download-btn" data-title="Download" data-toggle="dropdown" href="#">
                    <i class="icon-arrow-down Thirdcustom"></i>
                </a>
                <ul class="dropdown-menu custom">
                    <div class="btn-group-custom">
                        <button type="button" data-id="DivisionWiseSalesPlanChart" class="export-pdf btn default red-stripe"><i class="fa fa-file-pdf-o"></i>PDF</button>
                        <button type="button" data-id="DivisionWiseSalesPlanChart" class="export-img btn default blue-stripe"><i class="fa fa-image-o"></i>Image</button>
                        <button type="button" data-id="DivisionWiseSalesPlanChart" class="export-svg btn default green-stripe">SVG</button>
                    </div>
                </ul>
            </div>
            <a href="#Model_@actionPageId" data-toggle="modal" class="config"></a>
            <a href="javascript:;" class="reload"></a>
            <a href="javascript:;" class="fullscreen"></a>
            <a href="javascript:;" class="remove"></a>
        </div>
    </div>
    <div class="portlet-body">
        <script type="text/x-kendo-template" id="toolbar-template">
            <div class="k-header k-grid-toolbar pull-right">

                <a class="k-button k-button-icontext k-grid-excel" href="javascript:">
                    <i class="fa fa-file-excel-o"></i>
                </a>
        </script>
        <div class="k-content wide">
            <div id="DivisionWiseSalesPlanChart"></div>
            <div class="overlay"><div>No data available</div></div>
            <div class="AmountFigureType"></div>
            <div class="DisplayFilterContent"><a href="javascript:;" data-toggle="tooltip" title=""></a></div>
        </div>
    </div>

    <script>
        //initialize variables
        var config_DivisionWiseSalesPlan = {
            url: window.location.protocol + "//" + window.location.host + "/api/PlanChartReportApi/getDivisionWiseSalesPlanChart",
            childUrl : window.location.protocol + "//" + window.location.host + "/api/PlanChartReportApi/getDivisionEmployeeWiseSalesPlanChart",
            dateFormat: $("input[name=DateFormat_DivisionWiseSalesPlan]:checked").val(),
            fieldValue: $("input[name=fieldType_DivisionWiseSalesPlan]:checked").val(),
            series: [{
                field: "PER_DAY_AMOUNT",
                name: "GrossAmount"//"#= group.value #"
            }],
            isStack: false,
            showLabel: $("#showLabel_DivisionWiseSalesPlan").prop("checked"),
            color: ["#8A2BE2", "#ADFF2F", "#5bc0de", "#5cb85c", "#f2b661"],
            seriesType: $("input[name=seriesType_DivisionWiseSalesPlan]:checked").val(),
            categoryField:"DESCRIPTION", //"DIVISION_EDESC",
            categoryTitle: '',
            group: { field: "COMPANY_CODE" },
            sortField: "MONTHINT",
            sortFields: [{
                field: "YEAR",
                dir: "asc"
            }, {
                field: "MONTHINT",
                dir: "asc"
            }],
            _oldData: {
                dateFormat: $("input[name=DateFormat_DivisionWiseSalesPlan]:checked").val(),
                fieldValue: $("input[name=fieldType_DivisionWiseSalesPlan]:checked").val()
            },

        };
        var _oldConfig_DivisionWiseSalesPlan = JSON.stringify(config_DivisionWiseSalesPlan);



        function loadDataSource_DivisionWiseSalesPlan() {
            var url1;
            var param = {};
            if (isChild == undefined) {
                url1 = config_DivisionWiseSalesPlan.url;
                param= {
                    DateFormat: config_DivisionWiseSalesPlan.dateFormat
                };
            }
            else {
                url1 = config_DivisionWiseSalesPlan.childUrl ;
                param = { DateFormat: config_DivisionWiseSalesPlan.dateFormat, divisionCode: divisionCode };

            }
            reportFilter = reportFilter == undefined ? ReportFilter.filterAdditionalData() : reportFilter;
            var filter = $.extend(true, {}, reportFilter);
            config_DivisionWiseSalesPlan.dateFormat = $("input[name=DateFormat_DivisionWiseSalesPlan]:checked").val();
            config_DivisionWiseSalesPlan.showLabel = $("#showLabel_DivisionWiseSalesPlan").prop("checked");
            var dataSource = new kendo.data.DataSource({
                transport: {
                    read: {
                        //url: Arg.url(config_DivisionWiseSalesPlan.url, { DateFormat: config_DivisionWiseSalesPlan.dateFormat }),
                        url: Arg.url(url1,param),//Arg.url(url1),
                        //data: { DateFormat: config_DivisionWiseSalesPlan.dateFormat},
                        dataType: "json", // <-- The default was "jsonp".
                        type: "POST",
                        contentType: "application/json; charset=utf-8"
                    },
                    parameterMap: function (options, type) {
                        var paramMap = JSON.stringify($.extend(options, filter));
                        delete paramMap.$inlinecount; // <-- remove inlinecount parameter.
                        delete paramMap.$format; // <-- remove format parameter.
                        return paramMap;
                    }
                },
                requestStart: function () {
                    if (IsDataGrid != "Grid") {
                        kendo.ui.progress($("#DivisionWiseSalesPlanChart"), true);
                    }
                },
                requestEnd: function () {
                    kendo.ui.progress($("#DivisionWiseSalesPlanChart"), false);
                },
                schema: {
                    parse: function (items) {
                        var item,
                            result = [];
                        var showzerovalue = $("#showzerovalue_DivisionWiseSalesPlan").prop("checked");

                        if (showzerovalue) {
                            for (var i = 0; i < items.length; i++) {
                                item = items[i];
                                result.push(item);
                            }
                        }
                        else {
                            for (var i = 0; i < items.length; i++) {
                                item = items[i];
                                if (item.Amount !== 0 && item.Quantity !== 0) {
                                    result.push(item);
                                }
                            }
                        }


                        return result;
                    }
                },
                group: config_DivisionWiseSalesPlan.group,
                sort: config_DivisionWiseSalesPlan.sortFields
                //{
                //    field: config_DivisionWiseSalesPlan.sortField,
                //    dir: "asc"
                //}

            });

            $("#DivisionWiseSalesPlan .DisplayFilterContent a").text("");
            var IsDataGrid = $('.btnGrid_DivisionWiseSalesPlan').data("type");
            if (IsDataGrid == "Grid") {
                CreateGrid_DivisionWiseSalesPlan(dataSource);
                return;
            }

            $('.btnGrid_DivisionWiseSalesPlan').data("type", "Chart");
            CreateChart_DivisionWiseSalesPlan(dataSource);
            //CreateGrid_DivisionWiseSalesPlan(dataSource);
        }
        function CreateChart_DivisionWiseSalesPlan(dataSource) {
           //  var  childUrl = window.location.protocol + "//" + window.location.host + "/api/PlanChartReportApi/getDivisionEmployeeWiseSalesPlanChart";
            var amountorquantity = $("input[name=fieldType_DivisionWiseSalesPlan]:checked").val();
            var templa = amountorquantity == "Amount" ? "#= FormatSeriesLabels(value)#" : "#= FormatLabels(value)#"

            $('.btnGrid_DivisionWiseSalesPlan').data("type", "Chart");
            $("#DivisionWiseSalesPlanChart").html('');
            $("#DivisionWiseSalesPlanChart").removeAttr("style");
            $("#DivisionWiseSalesPlanChart").removeAttr("class");
            dataSource.group(config_DivisionWiseSalesPlan.group);
            $("#DivisionWiseSalesPlanChart").kendoChart({
                chartArea: {
                    height: ($("#DivisionWiseSalesPlanChart").hasClass("portlet-fullscreen")) ? 550 : 350,
                },
                onDrag: function (e) {
                    var chart = e.sender;
                    var ds = chart.dataSource;
                    var options = chart.options;

                    var categoryRange = e.axisRanges.CategoryAxis;

                    if (categoryRange) {
                        var xMin = categoryRange.min;
                        var xMax = categoryRange.max;

                        options.categoryAxis.min = xMin;
                        options.categoryAxis.max = xMax;

                        ds.filter(viewModel.getFilter(xMin, xMax));
                    }
                },
                pannable: {
                    lock: "y"
                },
                zoomable: {
                    mousewheel: {
                        lock: "y"
                    },
                    selection: {
                        lock: "y"
                    }
                },
                dataSource: dataSource,
                legend: {
                    position: "bottom",
                    visible:false
                },
                visibleInLegend: false,
                seriesColors: config_DivisionWiseSalesPlan.color,
                seriesDefaults: {
                    type: config_DivisionWiseSalesPlan.seriesType,
                    labels: {
                        visible: config_DivisionWiseSalesPlan.showLabel,
                        template: templa,// "#= FormatLabels(value)#", //
                        rotation: '270',
                        padding: {
                            left: -5
                        },
                    },
                    style: "smooth",
                },
                series: config_DivisionWiseSalesPlan.series,
                categoryAxis: {
                    field:config_DivisionWiseSalesPlan.categoryField,
                    labels: {
                        rotation: -45,
                    },
                    title: { text: $("#DivisionWiseSalesPlanChart").data("kendoChart") == undefined ? "" : $("#DivisionWiseSalesPlanChart").data("kendoChart").options.categoryAxis.title.text}
                    //text: config_DivisionWiseSalesPlan.categoryTitle
                    
                },
                valueAxis: {
                    line: {
                        visible: true
                    },
                    labels: {
                        rotation: 'auto',
                        template: templa// "#= FormatLabels(value)#"//
                    },
                    title: { text: amountFigureType }
                },
                tooltip: {
                    visible: true,
                    format: "{0}",
                    template: "#= category #: \n" + templa +"\n #=drillDownToolTipMessage(category)#"// #= FormatLabels(value) #
                },
                dataBound: function (e) {
                    var maxValue = getMaxValueFromDataSource(e);
                    var majorunit = Math.max(6, maxValue / 6);
                    e.sender.options.valueAxis.majorUnit = majorunit;
                    e.sender.options.valueAxis.max = maxValue + majorunit;
                    $("#DivisionWiseSalesPlanChart").next(".overlay").toggle(maxValue <= 0);
                    e.sender.options.categoryAxis.categories = getCategoryFromDataSource(e);
                    //
                    //if (totalChartList.length > 0) {
                    //    var chart = totalChartList[0];
                    //    totalChartList = totalChartList.splice(1, totalChartList.length);
                    //    loadChartSync(chart);
                    //}
                },
                //seriesClick: function (e) {
                //    if (e.dataItem.Day == null) {
                //        var url = window.location.protocol + "//" + window.location.host + "/api/SalesDashboard/GetSalesDailyFiscalYearReport?month=" + e.dataItem.MonthInt + "&dbName=" + e.dataItem.DBName;
                //        config_DivisionWiseSalesPlan.url = url;
                //        config_DivisionWiseSalesPlan.categoryField = "Day";
                //        config_DivisionWiseSalesPlan.categoryTitle = e.dataItem.DisplayMonth;
                //        loadDataSource_DivisionWiseSalesPlan();
                //    }
                //},

                //added by chandra
                seriesClick: function (e) {
                    var value = e.dataItem.DIVISION_CODE;
                    if (value == null) {
                        kendo.ui.progress($("#DivisionWiseSalesPlanChart"), false);
                        return false;
                    }
                    if (value == "NaN" || "") {
                        kendo.ui.progress($("#DivisionWiseSalesPlanChart"), false);
                        return;
                    }
                    isChild = true;
                    divisionCode = value;
                    $('#btnBack').show();
                    kendo.ui.progress($("#DivisionWiseSalesPlanChart"), true);
                    loadDataSource_DivisionWiseSalesPlan();
                    var chart = $("#DivisionWiseSalesPlanChart").data("kendoChart");
                    chart.setOptions({
                        categoryAxis: {
                            title: { text: e.category }
                        },
                    });
                    kendo.ui.progress($("#DivisionWiseSalesPlanChart"), false);

                   
                },
                //end added by chandra
            });
        }
        function drillDownToolTipMessage(text) {
            if (isChild == undefined || isChild == 'undefined') {
                return '<br/>click to show Employee wise sales plan of Division: ' + text;
            }
            return "";
        }

        function CreateGrid_DivisionWiseSalesPlan(dataSource) {

            $("#DivisionWiseSalesPlanChart").html('');
            $("#DivisionWiseSalesPlanChart").removeAttr("style");
            $("#DivisionWiseSalesPlanChart").removeAttr("class");
            $('.btnGrid_DivisionWiseSalesPlan').data("type", "Grid");
            var format = $("input[name=DateFormat_DivisionWiseSalesPlan]:checked").val();
            var monthTitle = "Month";
            dataSource = dataSource == undefined ? $("#DivisionWiseSalesPlanChart").data("kendoChart").dataSource : dataSource;
            if (dataSource.data().length > 0 && dataSource.data()[0].Day != null) {
                monthField = "Day";
                monthTitle = "Days [month : " + dataSource.data()[0].DisplayMonth + "]";
            }
            else {
                monthField = config_DivisionWiseSalesPlan.categoryField;
                monthTitle = "Month"
            }
            dataSource.group([]);
            $("#DivisionWiseSalesPlanChart").kendoGrid({
                dataSource: dataSource,
                height: $("#DivisionWiseSalesPlanChart").hasClass("portlet-fullscreen") ? 550 : 350,
                groupable: false,
                sortable: true,
                //selectable: "multiple",
                toolbar: [{ template: kendo.template($("#toolbar-template").html()) }],
                excel: {
                    fileName: "Sales Plan Report",
                    allPages: true
                },
                columns: [{
                    field: monthField,
                    title: isChild==undefined?"Division":"Employee",
                    width: 240
                },{
                    field: "PER_DAY_QUANTITY",
                    title: "Quantity",
                    format: "{0:n0}",
                    attributes:
                    {
                        style: "text-align:right;"
                    },

                }, {
                    field: "PER_DAY_AMOUNT",
                    title: "Amount",
                    format: "{0:n}",
                    attributes:
                    {
                        style: "text-align:right;"
                    },

                    }, {
                        field: "DIVISION_EDESC",
                        title : "Division",
                        //width:  240,
                        hidden: isChild ? false : true
                    }],
                dataBound: function (e) {
                    var gird = e.sender;
                    gird.table.find(".k-grouping-row:not(:first-child)").each(function () {
                        gird.collapseGroup(this);
                    });
                    
                }
            });
        }



        function refreshDivisionWiseSalesPlan() {
            if ($(".btnGrid_DivisionWiseSalesPlan").data("type") == "Grid")// data-grid toogle chart option in data-grid attribute in div
            {
                $(".btnGrid_DivisionWiseSalesPlan").data("type", "Chart");
                loadDataSource_DivisionWiseSalesPlan();
                return;
            }

            var chart = $("#DivisionWiseSalesPlanChart").data("kendoChart"),
                type = $("input[name=seriesType_DivisionWiseSalesPlan]:checked").val(),
                stack = $("#Stack_DivisionWiseSalesPlan").prop("checked"),
                IsLebelShow = $("#showLabel_DivisionWiseSalesPlan").prop("checked"),
                fieldValue = $("input[name=fieldType_DivisionWiseSalesPlan]:checked").val();

            for (var i = 0, length = config_DivisionWiseSalesPlan.series.length; i < length; i++) {
                config_DivisionWiseSalesPlan.series[i].stack = stack;
                config_DivisionWiseSalesPlan.series[i].type = type;
                if (fieldValue == "Amount")
                    config_DivisionWiseSalesPlan.series[i].field = "PER_DAY_AMOUNT";
                else
                    config_DivisionWiseSalesPlan.series[i].field = "PER_DAY_QUANTITY";

            };

            chart.setOptions({
                series: config_DivisionWiseSalesPlan.series,
            });

            for (var i = 0; i < chart.options.series.length; i++) {
                chart.options.series[i].labels.visible = IsLebelShow;
                if (type == "column") {
                    chart.options.series[i].labels.rotation = -90;
                }
                if (type == "bar") {
                    chart.options.series[i].labels.rotation = 0;
                }
            }

            chart.refresh();
        }
        $('#apply_DivisionWiseSalesPlan').click(function () {
            var checkedDateFormat = $("input[name=DateFormat_DivisionWiseSalesPlan]:checked").val();
            var checkedFieldValue = $("input[name=fieldType_DivisionWiseSalesPlan]:checked").val();
            var IsChanged = false;
            if (config_DivisionWiseSalesPlan._oldData.dateFormat != checkedDateFormat) {
                IsChanged = true;
                config_DivisionWiseSalesPlan = JSON.parse(_oldConfig_DivisionWiseSalesPlan);
                config_DivisionWiseSalesPlan._oldData.dateFormat = checkedDateFormat;

            }
            if (config_DivisionWiseSalesPlan._oldData.fieldValue != checkedFieldValue) {
                refreshDivisionWiseSalesPlan();
                config_DivisionWiseSalesPlan._oldData.fieldValue = checkedFieldValue;
            }
            $('.btnGrid_DivisionWiseSalesPlan').data("type", "Chart");
            ChartFilter('DivisionWiseSalesPlan', "loadDataSource_DivisionWiseSalesPlan", IsChanged);
        });
        var isChild;
        var divisionCode = 0;
        $(document).ready(function () {
            isChild = undefined;
            loadDataSource_DivisionWiseSalesPlan();

            //start Binding
            $(document).bind("kendo:skinChange", loadDataSource_DivisionWiseSalesPlan);

            $('#DivisionWiseSalesPlanChart').closest('.portlet').find('.reload').click(function () {
                RefreshChartFilterControl('DivisionWiseSalesPlan');
                $('.btnGrid_DivisionWiseSalesPlan').data("type", "Chart");
                config_DivisionWiseSalesPlan = JSON.parse(_oldConfig_DivisionWiseSalesPlan);
                loadDataSource_DivisionWiseSalesPlan();
            });



            $(".btnGrid_DivisionWiseSalesPlan").click(function () {
                var datasource = $("#DivisionWiseSalesPlanChart").data("kendoChart").dataSource;
                $('.btnGrid_DivisionWiseSalesPlan').data("type") == "Chart" ? CreateGrid_DivisionWiseSalesPlan(datasource) : CreateChart_DivisionWiseSalesPlan(datasource);
                $("i", this).toggleClass("icon-bar-chart");
            });
            $(".options_DivisionWiseSalesPlan").bind("change", function () {  // data-grid toogle chart option in data-grid attribute in button
                if ($('.btnGrid_DivisionWiseSalesPlan').data("type") == "Chart")
                    refreshDivisionWiseSalesPlan();
                else
                    chart_grid_option_change("btnGrid_DivisionWiseSalesPlan", "loadDataSource_DivisionWiseSalesPlan");
            });
            $("#showLabel_DivisionWiseSalesPlan").bind("change", function () {// data-grid toogle chart option in data-grid attribute in button
                var temp = $('.btnGrid_DivisionWiseSalesPlan').data("type");
                $('.btnGrid_DivisionWiseSalesPlan').data("type", "temp");
                refreshDivisionWiseSalesPlan()
                $('.btnGrid_DivisionWiseSalesPlan').data("type", temp);
            });
            $('#Stack_DivisionWiseSalesPlan').on('click', function () {// data-grid toogle chart option in data-grid attribute in button
                var temp = $('.btnGrid_DivisionWiseSalesPlan').data("type");
                $('.btnGrid_DivisionWiseSalesPlan').data("type", "temp");
                refreshDivisionWiseSalesPlan()
                $('.btnGrid_DivisionWiseSalesPlan').data("type", temp);
            });

        });

        $("#DivisionWiseSalesPlanChart").on('dblclick', ".k-state-selected", function (e) {
            var grid = $("#DivisionWiseSalesPlanChart").data("kendoGrid");
            var selectedItem = grid.dataItem(grid.select());
            if (selectedItem.Code != null) {
                var childUrl = window.location.protocol + "//" + window.location.host + "/api/PlanChartReportApi/getDivisionEmployeeWiseSalesPlanChart";
                var monthFiled = "MonthEnglish";
                var temp = childUrl + "?divisionCode=" + selectedItem.Code + categoryUrlData.replace('?', '&').replace('categoryCode', 'categoryCode2');
                var dataSourcetest = new kendo.data.DataSource({
                    transport: {
                        read: {
                            url: temp,
                            dataType: "json", // <-- The default was "jsonp".
                            type: "POST",
                            contentType: "application/json; charset=utf-8"
                        },
                        parameterMap: function (options, type) {
                            var paramMap = JSON.stringify($.extend(options, reportFilter));
                            delete paramMap.$inlinecount; // <-- remove inlinecount parameter.
                            delete paramMap.$format; // <-- remove format parameter.
                            return paramMap;
                        }
                    },
                    serverSorting: false,
                    serverPaging: true,
                    serverFiltering: false,
                    selectable: "multiple",
                    pageSize: 20,
                });
                //

                $("#DivisionWiseSalesPlanChart").html('');
                $("#DivisionWiseSalesPlanChart").kendoGrid({
                    dataSource: dataSourcetest,
                    height: ($("#DivisionWiseSalesPlanChart").hasClass("portlet-fullscreen")) ? 550 : 350,
                    groupable: false,
                    sortable: true,
                    //selectable: "multiple",
                    pageable: {
                        refresh: true,
                        pageSizes: true,
                        buttonCount: 5,
                    },
                    columns: [{
                        field: monthField,
                        title: monthTitle,
                        width: 240
                    }, {
                        field: "PER_DAY_QUANTITY",
                        title: "Quantity",
                        format: "{0:n0}",
                        attributes:
                        {
                            style: "text-align:right;"
                        },

                    }, {
                        field: "PER_DAY_AMOUNT",
                        title: "Amount",
                        format: "{0:n}",
                        attributes:
                        {
                            style: "text-align:right;"
                        },

                    }]
                });
            }
        })

        function FormatSeriesLabels(value) {
            if (isNaN(value))
                value = 0;
            var decimalPlaces = 2;
            if (ReportFilter.filterAdditionalData().ReportFilters.AmountRoundUpFilter != "" && ReportFilter.filterAdditionalData().ReportFilters.AmountRoundUpFilter != undefined) {
                if (ReportFilter.filterAdditionalData().ReportFilters.AmountRoundUpFilter.split(".").length > 1)
                    decimalPlaces = ReportFilter.filterAdditionalData().ReportFilters.AmountRoundUpFilter.split(".")[1].length;
                else
                    decimalPlaces = 0;
            }

            if (ReportFilter.filterAdditionalData().ReportFilters.AmountFigureFilter == "Lakh") {
                value = (value / 100000).toFixed(decimalPlaces) + " L";
            } else if (ReportFilter.filterAdditionalData().ReportFilters.AmountFigureFilter == "Thousand") {
                value = (value / 1000).toFixed(decimalPlaces) + " K";
            }
            else if (ReportFilter.filterAdditionalData().ReportFilters.AmountFigureFilter == "Crore") {
                value = (value / 10000000).toFixed(decimalPlaces) + " C";
            }
            else {
                value = (value / 100000).toFixed(decimalPlaces) + " L";
            }
            return kendo.format("{0:n" + ReportFilter.parseDecimalPlace("AmountRoundUpFilter").toString() + "}", value);
        }

        $('#btnBack').click(function () {
            isChild = undefined;
            $('#btnBack').hide();
            var chart = $("#DivisionWiseSalesPlanChart").data("kendoChart");
            chart.setOptions({
                categoryAxis: {
                    title: { text: "" }
                },
            });
            $(".btnGrid_DivisionWiseSalesPlan").data("type", "Chart");
            $('.btnGrid_DivisionWiseSalesPlan').children().removeClass().addClass('fa fa-table');
            loadDataSource_DivisionWiseSalesPlan();
        })
    </script>
</div>
