
@using NeoErp.Core.Models;
@{
    var actionPageId = "ExpensesTrendChartPartial";
}

<style>
    ul.dropdown-menu.custom {
        margin-top: 8px !important;
        border: none;
        box-shadow: none !important;
    }

    .dropdown-menu.custom:before {
        left: 58px !important;
    }

    .download-btn {
        margin: 0px !important;
        padding-top: -2px !important;
        padding-left: 0px;
        padding-right: 0px;
        margin-top: -5px !important;
        margin-left: 5px !important;
    }

    .dropdown-menu.custom {
        left: -27px !important;
        top: 20px !important;
    }

    .dropdown > .dropdown-menu:before, .dropdown-toggle > .dropdown-menu:before, .btn-group > .dropdown-menu:before {
        position: absolute;
        top: -8px;
        left: 30px;
        right: auto;
        display: inline-block !important;
        border-right: 8px solid transparent;
        border-bottom: 8px solid #e0e0e0;
        border-left: 8px solid transparent;
        content: '';
    }

    i.icon-arrow-down {
        color: #acacac;
    }

    .btn-group-custom button.btn {
        padding: 7px 7px !important;
        float: left;
    }

    .dropdown-menu.custom {
        left: -55px !important;
    }

    #ExpenseTrendBackButton {
        position: absolute;
        top: 52px;
        left: 36px;
        font-size: 18px;
    }

    a.SixbtnDatagrid {
        color: #acacac !important;
    }
</style>

<div class="modal fade" id="Model_@actionPageId" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog custom-chart">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title"><span class="fa fa-bar-chart"></span> Expenses Trend</h4>
            </div>
            <div class="modal-body bottom-gappingtwo form-horizontal">
                <div class="row">
                    <div class="expencestrend-chartbutton clearfix">
                        <div class="chart_button clearfix">
                            <div class="col-sm-12 col-md-12">
                                <div class="btn-group ExpensesTrend_options responsivegap" data-toggle="buttons">
                                    <button type="button" class="btn btn-sm default red-stripe">
                                        <i class="fa fa-bar-chart"></i>
                                        <input id="typeColumn" name="seriesType_ExpensesTrend"
                                               type="radio" value="column" checked="checked" autocomplete="off" />column
                                    </button>
                                    <button type="button" class="btn btn-sm default green-stripe">
                                        <i class="fa fa-bar-chart"></i>
                                        <input id="typeBar" name="seriesType_ExpensesTrend"
                                               type="radio" value="bar" autocomplete="off" />bar
                                    </button>
                                    <button type="button" class="btn btn-sm default purple-stripe">
                                        <i class="fa fa-line-chart"></i>
                                        <input id="typeLine" name="seriesType_ExpensesTrend"
                                               type="radio" value="line" autocomplete="off" />Line
                                    </button>
                                    @*<button type="button" class="btn btn-sm default blue-stripe">
                                            <i class="fa fa-area-chart"></i>
                                            <input id="typearea" name="seriesType_ExpensesTrend"
                                                   type="radio" value="area" autocomplete="off" />area
                                        </button>*@
                                </div>
                            </div>

                        </div>

                        <div class="col-sm-6 col-xs-12 col-md-6 margin_bottom">
                            <div class="choose-field">
                                <div class="fieldtitle">
                                    <h5> Choose Value Field</h5>
                                </div>
                                
                                    <!-- show labels & inStack option-->
                                    <div class="input-group">
                                        <div class="icheck-inline">
                                            <label>
                                                <input id="showlables_ExpensesTrend" type="checkbox" autocomplete="off" /> Show Labels
                                            </label>

                                        </div>
                                    </div>
                             
                                <div class="date-option" id="expensesTrendDateOption" style="display:none">
                                    <label for="ADFormat">
                                        <input type="radio" id="ADFormat" name="DateFormat_expensesTrend" value="AD" /> AD
                                    </label>
                                    <label for="BSFormat">
                                        <input type="radio" id="BSFormat" name="DateFormat_expensesTrend" checked="checked" value="BS" /> BS
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
               
                        <div class="filter_title">
                            <label class="filter-label">Advance Filter</label>
                        </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <div class="col-sm-10 col-md-11 col-xs-10">
                                <select id="accountMultiSelect_@actionPageId" multiple="multiple"></select>
                            </div>
                        </div>
                    </div>
                </div>

                        @Html.Partial("~/Views/Shared/Controls/DashboardChartFilter/_AdvancedFilter.cshtml", new AdvancedFilterSettingsModel()
                   {
                       ShowCustomerFilter = false,
                       ShowProductFilter = false,
                       ShowPartyTypeFilter = false,
                       ShowCategoryFilter = false,
                       ShowLocationFilter = false,
                       ShowDocumentFilter = false,
                       ShowCompanyFilter = false,
                       ShowBranchFilter = true,
                       ShowFiscalYearFilter=false,
                       IsPopUp = false,
                       ActionPageId = actionPageId
                   })

                  
            </div>
            <div class="modal-footer">
                @*<button type="button" class="btn default" data-dismiss="modal">Close</button>*@
                <button type="button" class="btn btn-green applydp" data-dismiss="modal" id="apply_@actionPageId">Apply</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

<div class="portlet portlet-sortable  light bordered" id="ExpensesTrendChartPartial">
    <div class="portlet-title">
        <div class="caption">
            <i class="icon-bar-chart font-green-haze"></i>
            <span class="caption-subject bold uppercase font-green-haze custom-modal">AccountWise Report</span>
        </div>
        <div class="tools">
            <a href="javascript:;" class="collapse"></a>
            <a class="btnGrid SixbtnDatagrid" data-type="Chart" data-title="Grid">
                <i class="fa fa-table"></i>
            </a>
            <div class="btn-group">
                <a class="btn dropdown-toggle download-btn" title="Download" data-toggle="dropdown" href="#">
                    <i class="icon-arrow-down Tencustom"></i>

                </a>
                <ul class="dropdown-menu custom Tenslidetoggle">
                    <div class="btn-group-custom">
                        <button type="button" data-id="ExpensesTrendChart" class="export-pdf btn default red-stripe"><i class="fa fa-file-pdf-o"></i>PDF</button>
                        <button type="button" data-id="ExpensesTrendChart" class="export-img btn default blue-stripe"><i class="fa fa-image-o"></i>Image</button>
                        <button type="button" data-id="ExpensesTrendChart" class="export-svg btn default green-stripe">SVG</button>
                    </div>
                </ul>
            </div>
            <a href="#Model_@actionPageId" data-toggle="modal" class="config">
            </a>
            <a href="javascript:;" class="reload">
            </a>
            <a href="javascript:;" class="fullscreen">
            </a>
            <a href="javascript:;" class="remove">
            </a>
        </div>
    </div>
    <div class="portlet-body">
        <script type="text/x-kendo-template" id="toolbar-template">
            <div class="k-header k-grid-toolbar pull-right">

                <a class="k-button k-button-icontext k-grid-excel" href="javascript:">
                    <i class="fa fa-file-excel-o"></i>
                </a>
        </script>
        <div class="k-content wide">
            <div id="ExpensesTrendChart"></div>
             <div class="overlay"><div>No data available</div></div>
            <div class="AmountFigureType"></div>
            <div class="DisplayFilterContent"><a href="#" data-toggle="tooltip" title=""></a></div>
            <div class=""><a id="ExpenseTrendBackButton" href="javascript:;" title="Back" class="fa fa-arrow-left" style="display:none"></a></div>
        </div>
    </div>
    <script>
        
        var toggleFlag_ExpensesTrendChartPartial = true;
        var reportFilterExpense = "";

        //LoadDataGrid function for data-grid
        function LoadDataGrid_ExpansesTrend(dataSource, monthField) {
             
            $("#ExpensesTrendChart").html('');
            $('.SixbtnDatagrid').data("type", "Grid");

            dataSource = dataSource == undefined ? $("#ExpensesTrendChart").data("kendoChart").dataSource : dataSource
            var title = $("#ExpensesTrendChart").data("kendoChart").options.categoryAxis.title.text;
            var column = "";
            if (monthField == undefined && dataSource.data().length > 0)
            {
                if (dataSource.data()[0].Day != null)
                {
                    monthField = 'Day';
                    column = "Day [" + title + "]";
                }                    
                else if (dataSource.data()[0].Month != null)
                {
                    monthField = 'Month';
                    column = "Month [" + title + "]";
                }
                else
                {
                    monthField = 'acc_group';
                    column = "Account";
                }

            }

            
            
            $("#ExpensesTrendChart").kendoGrid({
                dataSource: dataSource == undefined ? $("#ExpensesTrendChart").data("kendoChart").dataSource : dataSource,
                height: $("#ExpensesTrendChartPartial").hasClass("portlet-fullscreen") ? 550 : 350,
                groupable: false,
                sortable: true,
                // selectable: "multiple",
                toolbar: [{ template: kendo.template($("#toolbar-template").html()) }],
                excel: {
                    fileName: "AccountWise Report",
                    allPages: true
                },
                columns: [{
                    field: monthField,
                    title: column,
                    width: 240
                }, {
                    field: "Amount",
                    title: "Amount",
                    format: "{0:n}"
                }, ]
            });
        }

        function SixChartData() {
            var urlData = "?customerCode=&itemCode=&categoryCode=&companyCode=&branchCode=" + branchCodes + "&partyTypeCode=&formCode=&accountCode=";
            $('#ExpensesTrendChartPartial .SixbtnDatagrid').data("type", "Chart");
            //CreateExpensesTrendChart(urlData);
            LoadExpensesTrendChart($("#ExpensesTrendChart").data("kendoChart").dataSource, urlData);
            RefreshChartFilterControl('@actionPageId');

        }

        $(".SixbtnDatagrid").click(function () {
            //var datasource = $("#ExpensesTrendChart").data("kendoChart").dataSource;
            //var type = $('.SixbtnDatagrid').data("type");
            //if(type=="Chart"){
            //    LoadDataGrid_ExpansesTrend(datasource);
            //    $('.SixbtnDatagrid').data("type", "Grid");
            //}
            //else {
            //    LoadExpensesTrendChart(datasource);
            //    $('.SixbtnDatagrid').data("type", "Chart");
            //}
            $('.SixbtnDatagrid').data("type") == "Chart" ? LoadDataGrid_ExpansesTrend() : SixChartData();
            $("i", this).toggleClass("icon-bar-chart");
        });

        $("#ExpensesTrendChart").on('dblclick', ".k-state-selected", function (e) {
            var grid = $("#ExpensesTrendChart").data("kendoGrid");
            var selectedItem = grid.dataItem(grid.select());
            var monthWiseUrl = window.location.protocol + "//" + window.location.host + "/api/SalesDashboard/GetExpensesTrendAccountWiseMonthlyReport";
            var daywiseUrl = window.location.protocol + "//" + window.location.host + "/api/SalesDashboard/GetExpensesTrendAccountWiseDailyReport";
            var dateFormat = $('input[name=DateFormat_expensesTrend]:checked').val();
            var masterAccCode = selectedItem.Master_Acc_Code, month = selectedItem.MonthInt;
            if (masterAccCode != null && month == null) { // monthly
                var dataSourcetest = new kendo.data.DataSource({
                    transport: {
                        read: {
                            url: monthWiseUrl + "?master_acc_code=" + masterAccCode + "&DateFormat=" + dateFormat,
                            dataType: "json", // <-- The default was "jsonp".
                            type: "POST",
                            contentType: "application/json; charset=utf-8"
                        },
                        parameterMap: function (options, type) {
                            var paramMap = JSON.stringify($.extend(options, reportFilter));
                            delete paramMap.$inlinecount; // <-- remove inlinecount parameter.
                            delete paramMap.$format; // <-- remove format parameter.
                            return paramMap;
                        }
                    },
                    sort: {
                        field: "Month",
                        dir: "asc"
                    }
                });
                //
                $("#ExpensesTrendChart").html('');
                $("#ExpensesTrendChart").kendoGrid({
                    dataSource: dataSourcetest,
                    height: ($("#ExpensesTrendChart").hasClass("portlet-fullscreen")) ? 450 : 350,
                    groupable: false,
                    sortable: true,
                    selectable: "multiple",
                    toolbar: [{ template: kendo.template($("#toolbar-template").html()) }],
                    excel: {
                        fileName: "AccountWise Report",
                        allPages: true
                    },
                    columns: [{
                        field: "MonthYear",
                        title: "Month [Account : " + selectedItem.acc_group + "]",
                    },
                    {
                        field: "Amount",
                        title: "Amount",
                        format: "{0:n}"
                    }]
                });
            }
            else if (masterAccCode != null && month != null) { //daily
                 
                var dataSourcetest = new kendo.data.DataSource({
                    transport: {
                        read: {
                            url: daywiseUrl + "?master_acc_code=" + masterAccCode + "&month=" + month + "&DateFormat=" + dateFormat,
                            dataType: "json", // <-- The default was "jsonp".
                            type: "POST",
                            contentType: "application/json; charset=utf-8"
                        },
                        parameterMap: function (options, type) {
                            var paramMap = JSON.stringify($.extend(options, reportFilter));
                            delete paramMap.$inlinecount; // <-- remove inlinecount parameter.
                            delete paramMap.$format; // <-- remove format parameter.
                            return paramMap;
                        }
                    },
                    sort: {
                        field: "day",
                        dir: "asc"
                    }
                });
                //
                $("#ExpensesTrendChart").html('');
                $("#ExpensesTrendChart").kendoGrid({
                    dataSource: dataSourcetest,
                    height: ($("#ExpensesTrendChart").hasClass("portlet-fullscreen")) ? 450 : 350,
                    groupable: false,
                    sortable: true,
                    selectable: "multiple",
                    toolbar: [{ template: kendo.template($("#toolbar-template").html()) }],
                    excel: {
                        fileName: "AccountWise Report",
                        allPages: true
                    },
                    columns: [{
                        field: "Day",
                        title: "days [Account : " + selectedItem.acc_group + "][month : " + selectedItem.Month + "]",
                        width: 300
                    },
                    {
                        field: "Amount",
                        title: "Amount",
                        format: "{0:n}"
                    }]
                });
            }


        })
        function CreateExpensesTrendChart(urlData) {
            //disable ad/bs
            $('#expensesTrendDateOption').attr('style', 'display:none');
            $("#ExpenseTrendBackButton").hide();
            //urlData = (urlData == undefined) ? '' : urlData;
            urlData = (urlData == undefined) ? "?customerCode=&itemCode=&categoryCode=&companyCode=" + companyCodes + "&branchCode=" + branchCodes + "&partyTypeCode=&formCode=&accountCode=" : urlData;
            var mainUrl = window.location.protocol + "//" + window.location.host + "/api/SalesDashboard/GetExpensesTrendMonthlyReport";
            var monthWiseUrl = window.location.protocol + "//" + window.location.host + "/api/SalesDashboard/GetExpensesTrendAccountWiseMonthlyReport";
            var daywiseUrl = window.location.protocol + "//" + window.location.host + "/api/SalesDashboard/GetExpensesTrendAccountWiseDailyReport";
            var IsDataGrid = $('#ExpensesTrendChartPartial .SixbtnDatagrid').data("type");
            reportFilter = reportFilter == undefined ? ReportFilter.filterAdditionalData() : reportFilter;
            var dataSource = new kendo.data.DataSource({
                transport: {
                    read: {
                        url: mainUrl + urlData, // <-- Get data from here.
                        dataType: "json", // <-- The default was "jsonp".
                        type: "POST",
                        contentType: "application/json; charset=utf-8"
                    },
                    parameterMap: function (options, type) {
                        var paramMap = JSON.stringify($.extend(options, reportFilter));
                        delete paramMap.$inlinecount; // <-- remove inlinecount parameter.
                        delete paramMap.$format; // <-- remove format parameter.
                        return paramMap;
                    }
                },
                requestStart: function () {
                    if (IsDataGrid != "Grid") {
                        kendo.ui.progress($("#ExpensesTrendChart"), true);
                    }
                },
                requestEnd: function () {
                    kendo.ui.progress($("#ExpensesTrendChart"), false);
                },
                sort: {
                    field: "acc_group",
                    dir: "asc"
                },

            });
            // data-grid set option on ceate funciton

            if (IsDataGrid == "Grid") {
                LoadDataGrid_ExpansesTrend(dataSource);
                return;
            }
            $("#ExpensesTrendChartPartial .DisplayFilterContent a").text("");
            LoadExpensesTrendChart(dataSource, urlData);
        }
        function LoadExpensesTrendChart(dataSource, urlData) {
            urlData = (urlData == undefined) ? "?customerCode=&itemCode=&categoryCode=&companyCode=" + companyCodes + "&branchCode=" + branchCodes + "&partyTypeCode=&formCode=&accountCode=" : urlData;
            var mainUrl = window.location.protocol + "//" + window.location.host + "/api/SalesDashboard/GetExpensesTrendMonthlyReport";
            var monthWiseUrl = window.location.protocol + "//" + window.location.host + "/api/SalesDashboard/GetExpensesTrendAccountWiseMonthlyReport";
            var daywiseUrl = window.location.protocol + "//" + window.location.host + "/api/SalesDashboard/GetExpensesTrendAccountWiseDailyReport";
            reportFilter = reportFilter == undefined ? ReportFilter.filterAdditionalData() : reportFilter;

            dataSource = dataSource == undefined ? $("#ExpensesTrendChart").data("kendoChart").dataSource : dataSource            
            var monthField = 'acc_group';
            if (dataSource.data().length > 0)
            {
                if (dataSource.data()[0].Day != null)
                {
                    monthField = 'Day';
                   
                }                    
                else if (dataSource.data()[0].Month != null)
                {
                    monthField = 'Month';
                   
                }
                else
                {
                    monthField = 'acc_group';
                  
                }

            }
           

            $("#ExpensesTrendChart").kendoChart({
                chartArea: {
                    height: ($("#ExpensesTrendChartPartial").hasClass("portlet-fullscreen")) ? 550 : 350,
                },
                onDrag: function (e) {
                    var chart = e.sender;
                    var ds = chart.dataSource;
                    var options = chart.options;

                    var categoryRange = e.axisRanges.CategoryAxis;

                    if (categoryRange) {
                        var xMin = categoryRange.min;
                        var xMax = categoryRange.max;

                        options.categoryAxis.min = xMin;
                        options.categoryAxis.max = xMax;

                        ds.filter(viewModel.getFilter(xMin, xMax));
                    }
                },

                pannable: {
                    lock: "y"
                },
                zoomable: {
                    mousewheel: {
                        lock: "y"
                    },
                    selection: {
                        lock: "y"
                    }
                },
                dataSource: dataSource,
                title: {
                },
                legend: {
                    position: "bottom"
                },
                seriesColors: ["#428bca", "#da3b36", "#e67d4a", "#5bc0de", "#5cb85c", "#f2b661"],
                seriesDefaults: {
                    type: $("input[name=seriesType_ExpensesTrend]:checked").val(),
                    labels: {
                        visible: $("#showlables_ExpensesTrend").prop("checked"),
                        template: "#= FormatSeriesLabels(value)#",
                        rotation: '270',
                        padding: {
                            left: -5
                        },
                    }
                },
                valueAxis: {
                    line: {
                        visible: true
                    },
                    labels: {
                        rotation: 'auto',
                        template: "#= FormatSeriesLabels(value)#"
                    },
                    title: { text: amountFigureType }
                },
                series:
                [{
                    field: "Amount",
                    name: "Amount"
                }],
                categoryAxis: {
                    field: monthField,
                    labels: {
                        rotation: -45,
                    },
                    title: { text: $("#ExpensesTrendChart").data("kendoChart") == undefined ? "" : $("#ExpensesTrendChart").data("kendoChart").options.categoryAxis.title.text }
                },
                tooltip: {
                    visible: true,
                    format: "{0}",
                    template: "#= category #: \n #= FormatSeriesLabels(value)#"
                },
                dataBound: function (e) {

                    var data = e.sender.dataSource.view();
                    var fieldtype = e.sender.options.series[0].field
                    var max = 0;
                    if (fieldtype == "Amount") {

                        jQuery.map(data, function (obj) {
                            if (obj.Amount > max)
                                max = obj.Amount;
                        });
                        var majorunit = Math.max(6, max / 6);
                        e.sender.options.valueAxis.majorUnit = majorunit;

                        e.sender.options.valueAxis.max = max + majorunit;
                    } else {

                        jQuery.map(data, function (obj) {
                            if (obj.Quantity > max)
                                max = obj.Quantity;
                        });
                        var majorunit = Math.max(6, max / 6);
                        e.sender.options.valueAxis.majorUnit = majorunit;

                        e.sender.options.valueAxis.max = max + majorunit;
                    }
                    kendo.ui.progress($("#ExpensesTrendChart"), false);                   
                    $("#ExpensesTrendChart").next(".overlay").toggle(max <= 0);
                },
                seriesClick: function (e) {
                    kendo.ui.progress($("#ExpensesTrendChart"), true);
                    //enable ad/bs
                     
                    $('#expensesTrendDateOption').attr('style', 'display:normal');
                    var dateFormat = $('input[name=DateFormat_expensesTrend]:checked').val();
                    var boolvalue = !isNaN(parseFloat(e.category)) && isFinite(e.category);
                    if (boolvalue) {
                         kendo.ui.progress($("#ExpensesTrendChart"), false);
                        return false;                       
                    }
                    var masterAccCode = e.dataItem.Master_Acc_Code, month = e.dataItem.MonthInt;
                    var reportFilter = ReportFilter.filterAdditionalData();
                    if (reportFilterExpense != "")
                        reportFilter.ReportFilters.BranchFilter = reportFilterExpense;
                    if (masterAccCode != null && month == null) { // monthly
                        $("#ExpenseTrendBackButton").attr("data-url", monthWiseUrl + "?master_acc_code=" + e.dataItem.Master_Acc_Code + "&DateFormat=" + dateFormat);
                        $("#ExpenseTrendBackButton").attr("data-title", e.category);
                        var dataSourcetest = new kendo.data.DataSource({
                            transport: {
                                read: {
                                    url: monthWiseUrl + "?master_acc_code=" + e.dataItem.Master_Acc_Code + "&DateFormat=" + dateFormat, //e.dataItem.Master_Acc_Code
                                    dataType: "json", // <-- The default was "jsonp".
                                    type: "POST",
                                    contentType: "application/json; charset=utf-8"
                                },
                                parameterMap: function (options, type) {
                                    var paramMap = JSON.stringify(reportFilter);
                                    delete paramMap.$inlinecount; // <-- remove inlinecount parameter.
                                    delete paramMap.$format; // <-- remove format parameter.
                                    return paramMap;
                                }
                            },

                        });
                        var chart = $("#ExpensesTrendChart").data("kendoChart");
                        type = $("input[name=seriesType_ExpensesTrend]:checked").val(),
                        chart.setOptions({
                            seriesColors: ["#5cb85c", "#da3b36", "#e67d4a", "#5bc0de", "#428bca", "#f2b661"],
                            categoryAxis: {
                                field: "MonthYear",
                                // field: "Month",
                                labels: {
                                    template: "#: value #"
                                },
                                title: { text: e.category }
                            },
                        });
                        // chart.options.categoryAxis.field = "Month";

                        chart.setDataSource(dataSourcetest);
                        chart.refresh();
                    }
                    else if (masterAccCode != null && month != null) { //daily
                        $("#ExpenseTrendBackButton").show();
                        var dataSourcetest = new kendo.data.DataSource({
                            transport: {
                                read: {
                                    url: daywiseUrl + "?master_acc_code=" + e.dataItem.Master_Acc_Code + "&month=" + e.dataItem.MonthInt + "&DateFormat=" + dateFormat,
                                    dataType: "json", // <-- The default was "jsonp".
                                    type: "POST",
                                    contentType: "application/json; charset=utf-8"
                                },
                                parameterMap: function (options, type) {
                                    var paramMap = JSON.stringify(reportFilter);
                                    delete paramMap.$inlinecount; // <-- remove inlinecount parameter.
                                    delete paramMap.$format; // <-- remove format parameter.
                                    return paramMap;
                                }
                            },
                            sort: {
                                field: "Day",
                                dir: "asc"
                            }
                        });
                        var chart = $("#ExpensesTrendChart").data("kendoChart");

                        type = $("input[name=seriesType_ExpensesTrend]:checked").val(),
                        chart.setOptions({
                            seriesColors: ["#da3b36", "#f2b661", "#428bca", "#e67d4a", "#5bc0de", "#5cb85c"],
                            categoryAxis: {
                                field: "Day",
                                labels: {
                                    template: "#: value #"
                                },
                                title: { text: e.dataItem.acc_group + " >> " + e.category }
                            },
                            tooltip: {
                                template: "Day #= category #: \n #= FormatSeriesLabels(value)#"
                            },
                        });
                        chart.setDataSource(dataSourcetest);
                        chart.refresh();
                    }


                },
            });
        }
        function RefreshExpensesTrendChart() {
            $("#ExpenseTrendBackButton").hide();
            if ($(".ExpensesTrend_options").attr("data-type") == "Grid")// data-grid toogle chart option in data-grid attribute in div
            {
                $(".ExpensesTrend_options").attr("data-type", "Chart");
                CreateExpensesTrendChart();
                return;
            }
            var chart = $("#ExpensesTrendChart").data("kendoChart"),
                type = $("input[name=seriesType_ExpensesTrend]:checked").val(),
                fieldtype = $("input[name=fieldType_ExpensesTrend]:checked").val(),
            labels = $("#showlables_ExpensesTrend").prop("checked");
            for (var i = 0, length = chart.options.series.length; i < length; i++) {
                chart.options.series[i].type = type;
                chart.options.series[i].labels.visible = labels;
                //series[i].stack = stack;
            };
            if (labels) {

            }
            if (fieldtype == "Quantity") {
                for (var i = 0, length = chart.options.series.length; i < length; i++) {
                    chart.options.series[i].field = "Quantity";
                };
            }
            else {
                for (var i = 0, length = chart.options.series.length; i < length; i++) {
                    chart.options.series[i].field = "Amount";
                    //series[i].stack = stack;
                };
            }
            if (type == "column") {
                // chart.options.series[0].labels.position = "top";
                chart.options.series[0].labels.rotation = -90;
            }
            if (type == "bar") {
                //  chart.options.series[0].labels.position = "center";
                chart.options.series[0].labels.rotation = 0;
            }
            chart.refresh();
        }


        $("#ExpenseTrendBackButton").click(function () {

            var url = $("#ExpenseTrendBackButton").attr("data-url");
            if ($("#ExpenseTrendBackButton").attr("data-url") != null) {
                var dataSourcetest = new kendo.data.DataSource({
                    transport: {
                        read: {
                            url: $("#ExpenseTrendBackButton").attr("data-url"), //e.dataItem.Master_Acc_Code
                            dataType: "json", // <-- The default was "jsonp".
                            type: "POST",
                            contentType: "application/json; charset=utf-8"
                        },
                        parameterMap: function (options, type) {
                            var paramMap = JSON.stringify(reportFilter);
                            delete paramMap.$inlinecount; // <-- remove inlinecount parameter.
                            delete paramMap.$format; // <-- remove format parameter.
                            return paramMap;
                        }
                    },

                });
                var chart = $("#ExpensesTrendChart").data("kendoChart");

                type = $("input[name=seriesType_ExpensesTrend]:checked").val(),
                chart.setOptions({
                    seriesColors: ["#5cb85c", "#da3b36", "#e67d4a", "#5bc0de", "#428bca", "#f2b661"],
                    categoryAxis: {
                        field: "MonthYear",
                        labels: {
                            template: "#: value #"
                        },
                        title: { text: $("#ExpenseTrendBackButton").attr("data-title") }
                    },
                });
                chart.setDataSource(dataSourcetest);
                chart.refresh();
                $("#ExpenseTrendBackButton").attr("data-url", null);
            }
            else {
                CreateExpensesTrendChart();

            }
        });
        var defaultDateFormat_ExpensesTrend = "";
        $(document).ready(function () {
            defaultDateFormat_ExpensesTrend = $('input[name=DateFormat_expensesTrend]:checked').val();
            $("#ExpenseTrendBackButton").hide();
            $('[title="Download"]').tooltip({
                trigger: 'hover'
            });
            $('.icon-arrow-down.Tencustom').click(function () {
                $('.dropdown-menu.custom.Tenslidetoggle').slideToggle(200);
            });
            CreateExpensesTrendChart();

            $(".ExpensesTrend_options").bind("change", function () {
                if ($('.SixbtnDatagrid').data("type") == "Chart")
                    RefreshExpensesTrendChart();
                else
                    chart_grid_option_change("SixbtnDatagrid", 'CreateExpensesTrendChart');
            });
            $("#showlables_ExpensesTrend").bind("change", function () {
                var temp = $('.SixbtnDatagrid').data("type");
                $('.SixbtnDatagrid').data("type", "temp");
                RefreshExpensesTrendChart();
                $('.SixbtnDatagrid').data("type", temp);
            });
            $('#ExpensesTrendChart').closest('.portlet').find('.reload').click(function () {
                $("#ExpenseTrendBackButton").hide();
                var urlData = "?customerCode=&itemCode=&categoryCode=&companyCode=&branchCode=" + branchCodes + "&partyTypeCode=&formCode=&accountCode=";
                $('#ExpensesTrendChartPartial .SixbtnDatagrid').data("type", "Chart");
                $("#ExpensesTrendChart").data("kendoChart").options.categoryAxis.title.text = "";
                CreateExpensesTrendChart(urlData);               
                RefreshChartFilterControl('@actionPageId');
            });
            $('#ExpensesTrendChart').closest('.portlet').find('.fullscreen').click(function () {
                if ($(this).hasClass("on")) {
                    $("#ExpensesTrendChart").data("kendoChart").options.chartArea.height = 350;
                }
                else {
                    $("#ExpensesTrendChart").data("kendoChart").options.chartArea.height = 550;
                }
                $("#ExpensesTrendChart").data("kendoChart").dataSource.read();
                $("#ExpensesTrendChart").data("kendoChart").refresh();
            });
            $('#ExpensesTrendChart').closest('.portlet').find('.config').click(function () {
                $(this).closest('.portlet').css('zIndex', 10040);
            });

            $('#ExpensesTrendChart').closest('.portlet').find('.icon-arrow-down').click(function () {
                $(this).closest('.portlet').css('zIndex', 10040);
            });

            var autoCompleteurl = window.location.protocol + "//" + window.location.host + "/api/SalesDashboard/GetExpensesTrendAccount";
            var autoCompletedataSource = new kendo.data.DataSource({
                transport: {
                    read: {
                        url: autoCompleteurl,
                        dataType: "json",
                        contentType: "application/json; charset=utf-8"
                    }
                }
            });


            $('#accountMultiSelect_@actionPageId').kendoMultiSelect({
                dataSource: autoCompletedataSource,
                dataTextField: "acc_group",
                dataValueField: "Master_Acc_Code",
                height: 600,
                headerTemplate: '<div class="col-md-offset-4"><strong>Account...</strong></div>',
                placeholder: "Select Account...",
                autoClose: false,
                dataBound: function () {
                    var current = this.value();
                    this._savedOld = current.slice(0);
                }
            });
        });
    </script>
    <script>

        $('#apply_@actionPageId').click(function () {
            var checkedDateFormat = $('input[name=DateFormat_expensesTrend]:checked').val();
            var IsDateChanged = false;
            if (defaultDateFormat_ExpensesTrend != checkedDateFormat) {
                IsDateChanged = true;
                defaultDateFormat_ExpensesTrend = checkedDateFormat;
            }
            ChartFilter('@actionPageId', "CreateExpensesTrendChart", IsDateChanged);
        });
        //$("input[name=DateFormat_expensesTrend]").on('change', function () {
        //    $this = $(this);
        //    var master_acc_code = '';
        //    var dateFormat = $('input[name=DateFormat_expensesTrend]:checked').val();
        //    var chart = $("#ExpensesTrendChart").data("kendoChart");
        //    if (chart.dataSource.data().length > 0)
        //        master_acc_code = chart.dataSource._data[0].Master_Acc_Code;
        //    var monthWiseUrl = window.location.protocol + "//" + window.location.host + "/api/SalesDashboard/GetExpensesTrendAccountWiseMonthlyReport";
        //    var dataSourcetest = new kendo.data.DataSource({
        //        transport: {
        //            read: {
        //                url: monthWiseUrl + "?master_acc_code=" + master_acc_code + "&DateFormat=" + dateFormat,
        //                dataType: "json",
        //                type: "POST",
        //                contentType: "application/json; charset=utf-8"
        //            },
        //            parameterMap: function (options, type) {
        //                var paramMap = JSON.stringify($.extend(options, ReportFilter.filterAdditionalData()));
        //                delete paramMap.$inlinecount; // <-- remove inlinecount parameter.
        //                delete paramMap.$format; // <-- remove format parameter.
        //                return paramMap;
        //            }
        //        },
        //    });
        //    // data-grid set option on ceate funciton
        //    var IsDataGrid = $('.SixbtnDatagrid').data("grid");
        //    if (IsDataGrid == "Grid") {
        //        LoadDataGrid_ExpansesTrend(dataSourcetest);
        //        return;
        //    }
        //    var chart = $("#ExpensesTrendChart").data("kendoChart");

        //    type = $("input[name=seriesType_ExpensesTrend]:checked").val(),
        //    chart.setOptions({
        //        seriesColors: ["#5cb85c", "#da3b36", "#e67d4a", "#5bc0de", "#428bca", "#f2b661"],
        //        categoryAxis: {
        //            field: "MonthYear",
        //            labels: {
        //                rotation: -45,
        //            },
        //            title: { text: "" }
        //        },
        //        tooltip: {
        //            template: "#= category #: \n #= FormatLabels(value)#"
        //        },
        //    });
        //    chart.setDataSource(dataSourcetest);
        //    chart.refresh();
        //})

        //Export 
        $(".export-pdf").click(function () {
            var chartid = $(this).data("id");
            var chart = $("#" + chartid).getKendoChart();
            var filename = $(this).closest(".portlet-title").find(".custom-modal").html();
            chart.exportPDF({ paperSize: "auto", margin: { left: "1cm", top: "1cm", right: "1cm", bottom: "1cm" } }).done(function (data) {
                kendo.saveAs({

                    dataURI: data,
                    fileName: filename + ".pdf",
                    proxyURL: "//demos.telerik.com/kendo-ui/service/export"
                });
            });
        });

        $(".export-img").click(function () {
            var chartid = $(this).data("id");
            var chart = $("#" + chartid).getKendoChart();
            var filename = $(this).closest(".portlet-title").find(".custom-modal").html();
            chart.exportImage().done(function (data) {
                kendo.saveAs({
                    dataURI: data,
                    fileName: filename + ".png",
                    proxyURL: "//demos.telerik.com/kendo-ui/service/export",

                });
            });
        });

        $(".export-svg").click(function () {
            var chartid = $(this).data("id");
            var chart = $("#" + chartid).getKendoChart();
            var filename = $(this).closest(".portlet-title").find(".custom-modal").html();
            chart.exportSVG().done(function (data) {
                kendo.saveAs({
                    dataURI: data,
                    fileName: filename + ".svg",
                    proxyURL: "//demos.telerik.com/kendo-ui/service/export"
                });
            });
        });

        function FormatSeriesLabels(value) {
            if (isNaN(value))
                value = 0;
            var decimalPlaces = 2;
            if (ReportFilter.filterAdditionalData().ReportFilters.AmountRoundUpFilter != "" && ReportFilter.filterAdditionalData().ReportFilters.AmountRoundUpFilter != undefined) {
                if (ReportFilter.filterAdditionalData().ReportFilters.AmountRoundUpFilter.split(".").length > 1)
                    decimalPlaces = ReportFilter.filterAdditionalData().ReportFilters.AmountRoundUpFilter.split(".")[1].length;
                else
                    decimalPlaces = 0;
            }

            if (ReportFilter.filterAdditionalData().ReportFilters.AmountFigureFilter == "Lakh") {
                value = (value / 100000).toFixed(decimalPlaces) + " L";
            } else if (ReportFilter.filterAdditionalData().ReportFilters.AmountFigureFilter == "Thousand") {
                value = (value / 1000).toFixed(decimalPlaces) + " K";
            }
            else if (ReportFilter.filterAdditionalData().ReportFilters.AmountFigureFilter == "Crore") {
                value = (value / 10000000).toFixed(decimalPlaces) + " C";
            }
            else {
                value = (value / 100000).toFixed(decimalPlaces) + " L";
            }
            return kendo.format("{0:n" + ReportFilter.parseDecimalPlace("AmountRoundUpFilter").toString() + "}", value);
        }
    </script>

</div>
